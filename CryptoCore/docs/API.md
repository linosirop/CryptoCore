# CryptoCore — API документация

## Общая информация

**CryptoCore** — криптографическая библиотека и CLI-инструмент на C++,
предназначенный для шифрования файлов, аутентифицированного шифрования,
вычисления хэшей, MAC и деривации ключей.

- Язык: **C++17**
- Платформа: **Windows 11**
- Сборка: **CMake**
- Криптографическая база: **OpenSSL**

Документ описывает **публичный API** всех модулей проекта.

---

## Архитектура проекта

CryptoCore.cpp (CLI)
└── cli_parser
├── aes_primitive
├── modes (ECB, CBC, CFB, OFB, CTR, GCM)
├── aead (Encrypt-then-MAC)
├── hash (SHA-256, SHA3-256)
├── mac (HMAC)
├── kdf (PBKDF2, HKDF)
├── csprng
├── padding
└── file_io

yaml
Копировать код

CLI является тонкой оболочкой над библиотечными модулями.

---

## Модуль: AES primitive

**Файл:** `aes_primitive.h`

### Назначение
Низкоуровневая реализация блочного шифра AES для одного блока (16 байт).
Используется всеми режимами шифрования.

### Публичные функции

#### `aes_encrypt_block`
```cpp
std::vector<uint8_t> aes_encrypt_block(
    const std::vector<uint8_t>& key,
    const std::vector<uint8_t>& block
);
key — ключ AES (16 / 24 / 32 байта)

block — входной блок (16 байт)

return — зашифрованный блок (16 байт)

Ошибки:

std::invalid_argument — неверная длина ключа или блока

Security notes:

Функция не предназначена для шифрования данных произвольной длины.

Используется только внутри режимов.

aes_decrypt_block
Аналогично aes_encrypt_block, но выполняет расшифрование.

Модуль: Режимы блочного шифра
Файлы:
ecb.h, cbc.h, cfb.h, ofb.h, ctr.h

Назначение
Реализация режимов шифрования поверх AES.

Общие требования
Проверка длины ключа

Проверка IV (где применимо)

Корректная обработка padding (ECB, CBC)

ECB (Electronic Codebook)
Файл: ecb.h

Не использует IV

Работает только с padding

НЕБЕЗОПАСЕН для реальных данных

Security notes:

Допустим только для тестирования и учебных целей.

CBC (Cipher Block Chaining)
Файл: cbc.h

Использует IV (16 байт)

Требует padding

IV должен быть случайным и уникальным

CFB / OFB
Файлы: cfb.h, ofb.h

Потоковые режимы

Не требуют padding

IV обязателен

CTR (Counter mode)
Файл: ctr.h

Потоковый режим

Не требует padding

IV/nonce никогда не должен повторяться

Security notes:

Повторное использование IV = компрометация данных

Модуль: GCM (AEAD)
Файл: gcm.h

Назначение
Аутентифицированное шифрование (AES-GCM).

Обеспечивает:

Конфиденциальность

Целостность

Аутентичность данных

Особенности
Поддержка AAD (Additional Authenticated Data)

Генерация и проверка authentication tag

Security notes:

Проверка тега выполняется до выдачи plaintext

Повтор IV/nonce запрещён

Модуль: Encrypt-then-MAC (EtM)
Файл: etm.h

Назначение
Композиция:

Шифрование

Вычисление HMAC поверх (IV || ciphertext || AAD)

Security notes:
MAC проверяется до расшифрования

Используется для режимов без встроенной аутентификации

Модуль: Хэш-функции
SHA-256
Файл: sha256_stream.h

Поддержка потокового хэширования:

init

update

final

Используется для файлов произвольного размера.

SHA3-256
Файл: sha3_stream.h

Аналогично SHA-256, но на основе SHA-3.

Модуль: HMAC
Файл: hmac.h

Назначение
Вычисление и проверка HMAC.

Поддержка бинарных и файловых данных

Используется в EtM и как отдельный инструмент

Security notes:

Сравнение MAC должно быть константного времени

Модуль: KDF
PBKDF2
Файл: pbkdf2.h

Деривация ключа из пароля

Параметры: пароль, соль, число итераций, длина ключа

Security notes:

iterations > 0

рекомендуется ≥ 100 000

HKDF
Файл: hkdf.h

Реализация RFC 5869

Этапы extract + expand

Модуль: CSPRNG
Файл: csprng.h

Назначение
Генерация криптографически стойких случайных байт.

На Windows используется системный криптографический генератор.

Модуль: Padding
Файл: padding.h

Назначение
Реализация PKCS#7 padding.

Используется режимами ECB и CBC.

Модуль: File IO
Файл: file_io.h

Назначение
Безопасное чтение и запись файлов.

Бинарный режим

Корректная обработка ошибок файловой системы

Модуль: CLI Parser
Файлы: cli_parser.h, cli_parser.cpp

Назначение
Разбор аргументов командной строки и диспетчеризация операций.

Ошибки CLI:

отсутствующие аргументы

несовместимые флаги

неверные форматы hex/base64

ошибки аутентификации (GCM / HMAC / EtM)

Общие требования безопасности
Ключи и пароли не выводятся в лог

Проверка аутентичности выполняется до расшифрования

IV/nonce не должны повторяться

Ошибки не должны раскрывать чувствительную информацию